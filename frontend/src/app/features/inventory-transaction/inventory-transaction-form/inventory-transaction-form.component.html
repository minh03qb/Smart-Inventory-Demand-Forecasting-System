<mat-toolbar color="primary">
  <button mat-icon-button (click)="goBack()">
    <mat-icon>arrow_back</mat-icon>
  </button>
  <span>Create Import/Export Transaction</span>
  <span class="spacer"></span>
  <button mat-button (click)="logout()">Logout</button>
</mat-toolbar>

<div class="container">
  <div *ngIf="errorMessage" class="error-alert">
    <strong>Error:</strong> {{ errorMessage }}
  </div>

  <mat-card>
    <mat-card-content>
      <form [formGroup]="form" (ngSubmit)="submit()">
        <mat-form-field appearance="fill" class="full-width">
          <mat-label>Select Product</mat-label>
          <mat-select formControlName="productId">
            <mat-option *ngFor="let product of products" [value]="product.id">
              {{ product.name }} (Stock: {{ product.currentStock }})
            </mat-option>
          </mat-select>
          <mat-error *ngIf="form.get('productId')?.hasError('required')">
            Please select a product
          </mat-error>
        </mat-form-field>

        <div *ngIf="getSelectedProduct()" class="product-stock-info" 
             [class.low-stock]="getSelectedProduct()?.lowStock">
          <mat-icon>info</mat-icon>
          Current quantity: {{ getSelectedProduct()?.currentStock }}
          <span *ngIf="getSelectedProduct()?.lowStock"> - WARNING: LOW STOCK!</span>
        </div>

        <mat-form-field appearance="fill" class="full-width">
          <mat-label>Transaction Type</mat-label>
          <mat-select formControlName="type">
            <mat-option *ngFor="let t of types" [value]="t.value">
              {{ t.label }}
            </mat-option>
          </mat-select>
          <mat-hint *ngIf="!isAdmin()">STAFF can only create EXPORT transactions</mat-hint>
        </mat-form-field>

        <mat-form-field appearance="fill" class="full-width">
          <mat-label>Quantity</mat-label>
          <input matInput type="number" formControlName="quantity" min="1">
          <mat-error *ngIf="form.get('quantity')?.hasError('required')">
            Quantity is required
          </mat-error>
          <mat-error *ngIf="form.get('quantity')?.hasError('min')">
            Quantity must be greater than 0
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="fill" class="full-width">
          <mat-label>Note</mat-label>
          <textarea matInput formControlName="note" rows="3"></textarea>
        </mat-form-field>

        <div class="form-actions">
          <button mat-raised-button color="primary" type="submit" [disabled]="form.invalid || submitting">
            <mat-icon>save</mat-icon>
            {{ submitting ? 'Saving...' : 'Save Transaction' }}
          </button>
          <button mat-raised-button type="button" routerLink="/inventory-transaction">
            <mat-icon>cancel</mat-icon>
            Cancel
          </button>
        </div>
      </form>
    </mat-card-content>
  </mat-card>
</div>
